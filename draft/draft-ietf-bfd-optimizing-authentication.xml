<?xml version="1.0" encoding="US-ASCII"?>
<?rfc toc="yes"?>
<?rfc tocompact="yes"?>
<?rfc tocdepth="3"?>
<?rfc tocindent="yes"?>
<?rfc symrefs="yes"?>
<?rfc sortrefs="yes"?>
<?rfc comments="yes"?>
<?rfc inline="yes"?>
<?rfc compact="yes"?>
<?rfc subcompact="no"?>
<rfc
    category="std"
    docName="draft-ietf-bfd-optimizing-authentication-latest"
    ipr="trust200902"
    updates="5880"
    submissionType="IETF"
    consensus="true">
  <front>
    <title abbrev="BFD Authentication Optimization">Optimizing BFD
    Authentication</title>

    <author fullname="Mahesh Jethanandani" initials="M."
            surname="Jethanandani">
      <organization>Kloud Services</organization>
      <address>
        <postal>
          <street/>
          <city/>
          <region/>
          <code/>
          <country>USA</country>
        </postal>
        <phone/>
        <facsimile/>
        <email>mjethanandani@gmail.com</email>
        <uri/>
      </address>
    </author>

    <author fullname="Ashesh Mishra" initials="A" surname="Mishra">
      <organization>Aalyria Technologies</organization>
      <address>
        <postal>
          <street/>
          <city/>
          <region/>
          <code/>
          <country/>
        </postal>
        <phone/>
        <email>ashesh@aalyria.com</email>
      </address>
    </author>

    <author fullname="Ankur Saxena" initials="A" surname="Saxena">
      <organization>Ciena Corporation</organization>
      <address>
        <postal>
          <street>3939 N 1st Street</street>
          <city>San Jose</city>
          <region>CA</region>
          <code>95134</code>
          <country>USA</country>
        </postal>
        <phone/>
        <facsimile/>
        <email>ankurpsaxena@gmail.com</email>
        <uri/>
      </address>
    </author>

    <author fullname="Manav Bhatia " initials="M." surname="Bhatia ">
      <organization>Google</organization>
      <address>
        <postal>
          <street>Doddanekkundi</street>
          <city>Bangalore</city>
          <code>560048</code>
          <country>India</country>
	</postal>
        <email>mnvbhatia@google.com</email>
      </address>
    </author>

    <date/>
    <keyword>BFD</keyword>
    <keyword>authentication</keyword>

    <abstract>
      <t>This document describes an optimization to BFD Authentication as
      described in Section 6.7 of BFD RFC 5880. This document updates RFC
      5880.</t>
    </abstract>
  </front>

  <middle>
    <section title="Introduction">
      <t>Authenticating every <xref target="RFC5880">BFD</xref> control packet
      with <xref target="RFC1321">MD5
      Message-Digest Algorithm </xref>, or Secure Hash Algorithm (SHA-1)
      is a computationally intensive process. This makes it
      difficult, if not impossible to authenticate every packet - particularly
      at faster rates. Also, the recent escalating series of attacks on MD5
      and SHA-1 described in <xref target="SHA-1-attack1">Finding Collisions
      in the Full SHA-1 </xref> and <xref target="SHA-1-attack2">New Collision
      Search for SHA-1 </xref> raise concerns about their remaining useful
      lifetime as outlined in <xref target="RFC6151">Updated Security
      Considerations for the MD5 Message-Digest and the HMAC-MD5 Algorithm
      </xref> and <xref target="RFC6194">Security Considerations for the SHA-0
      and SHA-1 Message-Digest Algorithm </xref>. If replaced by stronger
      algorithms, the computational overhead, will make the task of
      authenticating every packet even more difficult to achieve.</t>

      <t>
	This document proposes that only BFD control packets that
	signal a state change, a demand mode change (to D bit) or a
	poll sequence change (P or F bit change) in a BFD control
	packet be categorized as a significant change. This document
	also proposes that all BFD control packets which signal a
	significant change MUST be authenticated. Other BFD control
	packets MAY be transmitted and received with either no
	authentication, or less expensive authentication.</t>

      <t>In the Up state, most packets that are transmitted and received have no state change
      associated with them. Limiting authentication to packets that affect a
      BFD session's state allows more sessions to be supported with this
      optimized method of authentication.</t>

      <t>To detect a Person In the Middle (PITM) attack, it is also proposed that
      a BFD control packet without a significant change be authenticated
      occasionally. The interval of the BFD control packets without a
      significant change can be configured depending on the capability
      of the system.</t>

      <t>The rest of this document is structured as follows: Section 2 talks
      about the changes to authentication mode as described in <xref
      target="RFC5880">BFD</xref>. Section 3 goes into the details of the new
      Authentication Type.</t>

      <section title="Requirements Language">
        <t>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
        "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
        document are to be interpreted as described in <xref
        target="RFC2119">BCP 14</xref> <xref target="RFC8174"/> when, and only
        when, they appear in all capitals, as shown here.</t>
      </section>

      <section anchor="note-to-rfc-editor" title="Note to RFC Editor">
        <t>
	  This document uses several placeholder values throughout the
	  document. Please replace them as follows and remove this
	  note before publication.
	</t>

        <t>
	  RFC XXXX, where XXXX is the number assigned to this document
	  at the time of publication.
	</t>

        <t>
	  YYYY-MM-DD with the actual date of the publication of this
	  document.
	</t>
      </section>

      <section title="Terminology">
        <t>The following terms used in this document have been defined in
        <xref target="RFC5880">BFD</xref>.</t>

        <t><list style="symbols">
            <t>Detect Multiplier</t>

            <t>Detection Time</t>
          </list></t>

        <t>The following terms are introduced in this document.</t>

        <texttable style="full">
          <ttcol>Term</ttcol>
          <ttcol>Meaning</ttcol>
          <c>significant change</c>
          <c>
	    State change, a demand mode change (to D bit) or a poll
	    sequence change (P or F bit).
	  </c>
          <c>configured interval</c>
          <c>
	    Interval at which BFD control packets are retried with a
	    stronger authentication.
	  </c>
        </texttable>
      </section>
    </section>

    <section title="Authentication Mode  ">
      <t>The cryptographic authentication mechanisms specified in <xref
      target="RFC5880">BFD</xref> describes enabling and disabling of
      authentication as a one time operation. As a security precaution, it
      mentions that authentication state be allowed to change at most once.
      Once enabled, every packet must have Authentication Bit set and the
      associated Authentication Type appended. In addition, it states that an
      implementation SHOULD NOT allow the authentication state to be changed
      based on the receipt of a BFD control packet.</t>

      <t>This document proposes that the authentication mode be modified to be
      enabled on demand. Instead of authenticating every packet, BFD peers are
      configured for which packets need to be authenticated, and authenticate
      only those packets. The remaining packets MAY be transmitted and received
      without authentication, or use a less expensive authentication.
      For example, the two ends can be configured such
      that BFD control packets that indicate a significant change should be
      authenticated and enable authentication on those packets only. If the
      two ends have previously been configured as such, but at least one side
      decides not to authenticate a significant change packet, then the BFD
      session will fail to come up.</t>

      <t>
	This proposal outlines which BFD control packets are required to be
	authenticated. A BFD control packet that fails
	authentication is discarded, or a BFD control packet that was
	supposed to be authenticated, but was not; e.g. a significant
	change packet, is discarded. However, there is no change to
	the state machine for BFD, as the decision of a significant
	change is still decided by how many valid consecutive packets
	were received, authenticated or otherwise.
      </t>

      <t>
	The following table summarizes when the bfd.AuthType should be
	set with a Auth or a OPT authentication type.  The table
	should be read with the column indicating the BFD state the
	receiver is currently in, and the row indicating the BFD state
	the receiver might transition to based on the BFD control
	packet received.  The intersection of the two indicates
	whether the received BFD control packet should have the
	bfd.AuthType set to either Auth, or OPT.  The BFD state
	refers to the states in BFD state machine described in Section
	6.2 of <xref target="RFC5880">BFD</xref>.
      </t>

      <t>
	<figure align="center" title="Optimized Authentication Map">
          <artwork>
	    <![CDATA[
       Read   : On state change from <column> to <row>
       Auth   : Authenticate BFD control packet. Use non-zero value.
       OPT    : Any or no authentication, as configured.
       n/a    : Invalid state transition.
       Select : Most packets OPT AUTH. Selective (periodic)
                packets authenticated.
      +--------+--------+--------+--------+
      |        | DOWN   | INIT   | UP     |
      +--------+--------+--------+--------+
      | DOWN   |  OPT   |  Auth  |  Auth  |
      +--------+--------+--------+--------+
      | INIT   |  Auth  |  OPT   |  n/a   |
      +--------+--------+--------+--------+
      | UP     |  Auth  |  Auth  | Select |
      +--------+--------+--------+--------+
	    ]]>
	  </artwork>
	</figure>
      </t>

      <t>If P or F bit changes value, the BFD control packet MUST be
      authenticated. If the D bit changes value, the BFD control packet MUST
      be authenticated.</t>

      <t>
	Implementations supporting this feature will send BFD packets
	with authentications that always carry a meticulously increasing
	sequence number.  This meticulously increasing sequence number
	prevents replay attacks.
      </t>

      <t>
	The OPT Authentication type is defined in Section 3.  This
	authentication type does not provide any authentication of
	BFD Control Up packets, but does carry a meticulously increasing
	sequence number compatible with this specification.
      </t>

      <t>
	<xref target="I-D.ietf-bfd-secure-sequence-numbers">Secure BFD
	Sequence Numbers</xref> defines an authentication mechanism that
	does not provide any authentication of the BFD Control packets,
	carries a meticulously increasing sequence number, and provides
	for a stronger mechanism to prevent active attacks against these
	procedures for Up packets not requiring strong authentication.
      </t>

      <t>
	Most packets transmitted on a BFD session are BFD Up packets.
	Authenticating a small subset of these packets, for example
	every one minute, significantly reduces the computational
	demand for the system while maintaining security of the
	session across the configured interval.
      </t>
    </section>

    <section anchor="opt-auth-type" title="OPT Auth Type">
      <t>This section describes a new Authentication Type as:
      <figure
          align="center" title="OPT Auth Type">
        <artwork><![CDATA[       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |   Auth Type   |   Auth Len    |  Auth Key ID  |   Reserved    |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                        Sequence Number                        |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      ]]></artwork>
      </figure>
      where:
      </t>

      <t>Auth Type: The Authentication Type, which in this case is TBD (OPT,
      to be assigned by IANA)</t>

      <t>Auth Len: The length of the OPT Auth Type, in bytes; i.e. 8 bytes</t>

      <t>Auth Key ID: The authentication key ID in use for this packet. Must
      be set to zero.</t>

      <t>Reserved: This byte MUST be set to zero on transmit and ignored on
      receive.</t>

      <t>Sequence Number: The sequence number for this packet.  Implementations
      will use sequence numbers (bfd.XmitAuthSeq) as defined in <xref
      target="RFC5880">BFD</xref>.</t>

      <t>
	Once the session has reached the Up state, the session can choose
	the Auth Type to be one of:

	<ul>
	  <li>No authentication. (I.e., Authentication Present bit is zero.)</li>
	  <li>OPT Authentication type as defined in this document.</li>
	  <li>Meticulous Keyed ISAAC authentication as described in 
	    <xref target="I-D.ietf-bfd-secure-sequence-numbers">Secure
	    BFD Sequence Numbers</xref>.</li>
	</ul>
      </t>

      <t>
	The use of OPT or Meticulous Keyed
	ISAAC authentication methods protects against replay attacks
	by allowing the session to maintain an incrementing sequence
	number for all packets.
      </t>
    </section>

    <section anchor="opt-auth-yang-model" title="Optimizing Authentication YANG Model">
      <section anchor="data-model-overview" title="Data Model Overview">
	<t>
	  The <xref target="RFC7950">YANG 1.1</xref> model defined in
	  this document augments the "ietf-bfd" module to add
	  configuration relevant to the management of the feature
	  defined in this document. In particular, it adds crypto
	  algorithms that are described in this model, and in <xref
	  target="I-D.ietf-bfd-secure-sequence-numbers">Secure BFD
	  Sequence Numbers</xref>. It adds a feature statement to
	  enable optimized authentication. Finally, it adds a flag to
	  enable optimized authentication, an interval value that
	  specifies how often the BFD session should be
	  re-authenticated once it is in the Up state, and the key chain
	  that should be used in the Up state.
	</t>
      </section>
      <section anchor="tree-diagram" title="Tree Diagram">
	<t>
	  The tree diagram for the YANG modules defined in this
	  document use annotations defined in <xref
	  target="RFC8340">YANG Tree Diagrams.</xref>.
	</t>
	<t>
	  <figure>
            <artwork><![CDATA[
	    INSERT_TEXT_FROM_FILE(../bin/ietf-bfd-opt-auth@YYYY-MM-DD-tree.txt,69)
	    ]]></artwork>
          </figure>
	</t>
      </section>
      <section anchor="the-yang-model" title="The YANG Model">
	<t>
	  This YANG module imports <xref target="RFC8177">YANG Key
	  Chain </xref>, <xref target="RFC8349">A YANG Data Model for
	  Routing Management (NMDA version)</xref>, and <xref
	  target="RFC9314">YANG Data Model for Bidirectional Forwading
	  Detection (BFD)</xref>.
	</t>
	<t>
	  <figure>
            <artwork><![CDATA[
	    <CODE BEGINS> file "ietf-bfd-opt-auth@YYYY-MM-DD.yang"
	    INSERT_TEXT_FROM_FILE(../bin/ietf-bfd-opt-auth@YYYY-MM-DD.yang,69)
	    <CODE ENDS>
	    ]]></artwork>
          </figure>
	</t>
      </section>
    </section>

    <section anchor="IANA" title="IANA Considerations">
      <t>
	This documents requests one new authentication type, one URI,
	one YANG model, and an update to an existing IANA YANG model.
      </t>
      <section anchor="auth-type" title="Auth Type">
	<t>
	  This document requests an update to the registry titled "BFD
	  Authentication Types". IANA is requested to assign a new BFD
	  AuthType for <xref target="opt-auth-type">OPT Auth
	  Type</xref>.
	</t>
      </section>
      <section anchor="ietf-xml-registry" title="IETF XML Registry">
	<t>
	  This document registers one URIs in the "ns" subregistry of
	  the "IETF XML" registry <xref target="RFC3688"/>. Following
	  the format in <xref target="RFC3688"/>, the following
	  registration is requested:
	</t>
        <t>
	  <figure>
            <artwork>
	      <![CDATA[
URI: urn:ietf:params:xml:ns:yang:ietf-bfd-opt-auth
Registrant Contact: The IESG
XML: N/A, the requested URI is an XML namespace.
	      ]]>
	    </artwork>
          </figure>
	</t>
      </section>
      <section anchor="yang-module-names" title="The YANG Module Names Registry">
        <t>
	  This document registers one YANG modules in the "YANG Module
	  Names" registry <xref target="RFC6020"/>. Following the
	  format in <xref target="RFC6020"/>, the following
	  registrations are requested:
	</t>
        <t>
	  <figure>
	    <artwork>
	      <![CDATA[
name:         ietf-bfd-opt-auth
namespace:    urn:ietf:params:xml:ns:yang:ietf-bfd-opt-auth
prefix:       bfdoa
reference:    RFC XXXX
	      ]]>
	    </artwork>
          </figure>
	</t>
      </section>
      <section anchor="updated-iana-module" title="Updated IANA Module">
	<t>
	  This document also requests an update to an existing IANA
	  YANG module described in <xref
	  target="updated-bfd-iana-module">Updated BFD IANA
	  Module</xref>
	</t>
      </section>
    </section>

    <section anchor="Security" title="Security Considerations">
      <t>The approach described in this document enhances the ability to
      authenticate a BFD session by taking away the onerous requirement that
      every BFD control packet be authenticated. By authenticating packets
      that affect the state of the session, the security of the BFD session is
      maintained. In this mode, packets that are a significant change but are
      not authenticated, are dropped by the system. Therefore, a malicious
      user that tries to inject a non-authenticated packet; e.g. with a Down
      state to take a session down will fail. That combined with the proposal
      of using sequence number defined in <xref
      target="I-D.ietf-bfd-secure-sequence-numbers">Secure BFD Sequence
      Numbers</xref> further enhances the security of BFD sessions.</t>
    </section>

    <section title="Contributors" anchor="contributors">
      <t>
	The authors of this document would like to acknowledge Jeff
	Haas as a contributor to this document. Jeff played a role not
	only as a shepherd but also actively contributed to the
	improvement of the document.
      </t>
    </section>
  </middle>

  <back>
    <references title="Normative References">
      <?rfc include="reference.RFC.2119.xml"?>
      <?rfc include='reference.RFC.3688.xml'?>
      <?rfc include='reference.RFC.5880.xml'?>
      <?rfc include='reference.RFC.6020.xml'?>
      <?rfc include='reference.RFC.7950.xml'?>
      <?rfc include='reference.RFC.8174.xml'?>
      <?rfc include='reference.RFC.8177.xml'?>
      <?rfc include='reference.RFC.8340.xml'?>
      <?rfc include='reference.RFC.8349.xml'?>
      <?rfc include='reference.RFC.9127.xml'?>
      <?rfc include='reference.RFC.9314.xml'?>
      <?rfc include='reference.I-D.ietf-bfd-secure-sequence-numbers.xml'?>
    </references>

    <references title="Informative References">
      <reference anchor="SHA-1-attack1">
        <front>
          <title>Finding Collisions in the Full SHA-1</title>

          <author initials="X." surname="Wang">
            <organization/>
          </author>

          <author initials="Y." surname="Yin">
            <organization/>

            <address>
              <postal>
                <street/>

                <city/>

                <region/>

                <code/>

                <country/>
              </postal>

              <phone/>

              <facsimile/>

              <email/>

              <uri/>
            </address>
          </author>

          <author initials="H." surname="Yu">
            <organization/>

            <address>
              <postal>
                <street/>

                <city/>

                <region/>

                <code/>

                <country/>
              </postal>

              <phone/>

              <facsimile/>

              <email/>

              <uri/>
            </address>
          </author>

          <date year="2005"/>
        </front>
      </reference>

      <reference anchor="SHA-1-attack2">
        <front>
          <title>New Collision Search for SHA-1</title>

          <author initials="X." surname="Wang">
            <organization/>
          </author>

          <author initials="A." surname="Yao">
            <organization/>

            <address>
              <postal>
                <street/>

                <city/>

                <region/>

                <code/>

                <country/>
              </postal>

              <phone/>

              <facsimile/>

              <email/>

              <uri/>
            </address>
          </author>

          <author initials="F." surname="Yao">
            <organization/>

            <address>
              <postal>
                <street/>

                <city/>

                <region/>

                <code/>

                <country/>
              </postal>

              <phone/>

              <facsimile/>

              <email/>

              <uri/>
            </address>
          </author>

          <date year="2005"/>
        </front>
      </reference>

      <?rfc include='reference.RFC.1321.xml'?>

      <?rfc include='reference.RFC.6151.xml'?>

      <?rfc include='reference.RFC.6194.xml'?>
    </references>
    <section anchor="updated-bfd-iana-module" title="Updated BFD IANA Module">
      <t>
	This section carries the updated IANA BFD Module,
	iana-bfd-types.yang module, first defined in <xref
	target="RFC9127">YANG Data Model for Bidirectional Forward
	Detection (BFD)</xref>. The updated module carries two new
	authentication type enum definitions, 'opt' of value 6, and
	'meticulous-keyed-isaac' of value 7. This module should
	replace the version that currently exists in the IANA
	registry.
      </t>
	<t>
          <figure>
            <artwork><![CDATA[
	    <CODE BEGINS> file "iana-bfd-types@YYYY-MM-DD.yang"
            INSERT_TEXT_FROM_FILE(../bin/iana-bfd-types@YYYY-MM-DD.yang,68)
	    <CODE ENDS>
            ]]>
            </artwork>
          </figure>
	</t>
    </section>
    <section anchor="examples" title="Examples">
      <t>
	This section tries to show some examples in how the model can
	be configured.
      </t>
      <section anchor="example-a.1.1" title="Single Hop BFD Configuration">
	<t>
          This example demonstrates how a Single Hop BFD session can
          be configured for optimized authentication.
	</t>
	<t>
          <figure>
            <artwork><![CDATA[
            INSERT_TEXT_FROM_FILE(../src/yang/example-ip-sh-bfd-config-a.1.1.xml,68)
            ]]>
            </artwork>
          </figure>
	</t>
      </section>
    </section>      
  </back>
</rfc>
